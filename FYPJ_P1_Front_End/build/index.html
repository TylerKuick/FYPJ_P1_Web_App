<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Looker Dashboard</title>
  </head>
  <body>
    <iframe 
      id="lookerReport"
      width="100%" 
      height="900" 
      src="https://lookerstudio.google.com/embed/reporting/3bfc8308-0e99-429a-8d5e-5a8799d25874/page/p_fona0n94gd" 
      frameborder="0" 
      style="border:0;overflow:hidden;" 
      allowfullscreen 
      sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox">
    </iframe>

    <!-- Set src link with extracted patient document ID -->
    <script>
      // Objective of Script: Filter the embeded Looker Report according to the provided patient document id by modifying the embed URL.
      // Get URL used by Android WebView (https://enhance-bdc3f.web.app/?...)
      const androidUrl = window.location.href;
      console.log("URL from Android WebView:")
      console.log(androidUrl);

      // Due to Firebase Hosting, cannot use normal search params method of passing info (www.url.com?search=documentID) 
      // Split the url using "/?" as delimiter. Creates an array where "enhance-bdc3f.web.app" is at index 0 and 
      //"params={ds14.documentid}" is at index 1. 
      const params = androidUrl.split("/?")[1];
      console.log("Params");
      console.log(params);

      // Craft URL to insert into iframe src. 
      const lookerUrl = "https://lookerstudio.google.com/embed/reporting/3bfc8308-0e99-429a-8d5e-5a8799d25874/page/p_fona0n94gd?" + params;
      console.log("Looker Report URL:");
      console.log(lookerUrl);

      // Set src of iframe to the crafted looker embed URL.
      document.getElementById('lookerReport').src = lookerUrl;
    </script>
  </body>
</html>
